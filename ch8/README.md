# 第8章 監視と運用 - サンプルコード

## 概要

`chapter8_quickstart.py` は、第8章で解説した監視・運用機能の動作を一通り確認できるDatabricksノートブックです。

## 前提条件

- Databricks Runtime 15.0 ML以上
- MLflow 3.1以上(ノートブック内で自動インストール)
- OpenAI APIキーがDatabricksシークレットに設定済み

## セットアップ時の注意

**エクスペリメント名について:** エクスペリメント名はノートブック名と異なる名前にしてください。同じ名前にするとノートブックエクスペリメントとして扱われ、管理がわかりにくくなります。

```python
# 良い例: ノートブック名(chapter8_quickstart)と異なる名前
experiment_path = "/Shared/experiments/chapter8-monitoring"

# 避けるべき例: ノートブック名と同じ
experiment_path = "/Shared/chapter8_quickstart"  # ノートブックエクスペリメントになる
```

## 確認できる機能

| セクション | 本文の対応箇所 | 機能 |
|-----------|---------------|------|
| 2 | 8.1.2 効果的なトレース設計の指針 | SpanType、属性記録、エラーコンテキスト |
| 3 | 8.2.2 トークン使用量の自動追跡 | LLM呼び出し(自動トレーシング) |
| 4 | 8.2.2 トークン使用量の自動追跡 | トークン使用量の確認 |
| 4.1 | 8.2.3 コスト計算の実装 | コスト計算 |
| 5 | 8.3.3 ユーザーフィードバックの収集 | フィードバックの記録 |
| 6 | 8.3.4 LLM-as-a-Judgeによる自動評価 | リアルタイムスコアラーの登録・開始 |
| 7 | 8.3.4 LLM-as-a-Judgeによる自動評価 | 登録済みスコアラーの確認 |

## 使い方

1. `chapter8_quickstart.py` をDatabricksワークスペースにインポート
2. OpenAI APIキーをシークレットに設定
3. エクスペリメントパスを環境に合わせて変更
4. 上から順にセルを実行

## 注意事項

- スコアラー機能(セクション6, 7)は`databricks-agents`パッケージが必要(自動インストール)
- 料金は2025年12月時点の参考値です
